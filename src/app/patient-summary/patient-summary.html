<!-- src/app/patient-summary/patient-summary.component.html -->

<div class="min-h-screen bg-slate-50 flex flex-col">
  <header class="bg-white border-b px-8 py-4 sticky top-0 z-20">
    <div class="flex justify-between items-center">
      <!-- LEFT SIDE -->
      <div class="flex items-center space-x-4">
        <!-- Back button -->
        <button
          (click)="closePanel()"
          class="text-slate-400 hover:text-slate-600 transition-colors"
        >
          <ion-icon name="chevron-back-outline" class="text-2xl"></ion-icon>
        </button>

        <!-- Brand -->
        <div class="text-xs font-semibold text-indigo-600 bg-indigo-50 px-2 py-1 rounded">
          LANCE AI
        </div>

        <div class="w-px h-8 bg-slate-200"></div>

        <!-- NAME + MRN + AGENCY -->
        <div class="flex flex-col leading-tight">
          <h1 class="text-base font-semibold text-slate-900">
            {{ patientSummary.demographics.name }}
          </h1>

          <div class="text-left mt-0.5">
            <p class="text-xs text-slate-500">
              <span class="font-medium">{{ patientSummary.mrn }}</span>
            </p>
            <p class="text-[0.7rem] text-slate-500">
              {{ patientSummary.demographics.agencyName }}
            </p>
          </div>
        </div>
      </div>

      <!-- RIGHT SIDE HIPPS / PAYMENT -->
      <div class="hidden lg:flex items-center space-x-8">
        <!-- HIPPS CODE -->
        <div class="border border-indigo-200 bg-indigo-50 rounded-lg px-4 py-2">
          <p class="text-[0.65rem] text-slate-500">HIPPS Code</p>
          <p class="text-lg font-semibold text-slate-900 tracking-wide">
            {{ patientSummary.payment.hippsCode }}
          </p>
        </div>

        <!-- TOTAL PAYMENT -->
        <div class="border border-emerald-200 bg-emerald-50 rounded-lg px-4 py-2">
          <p class="text-[0.65rem] text-slate-500">Total Payment</p>
          <p class="text-lg font-semibold text-emerald-700">
            {{ patientSummary.payment.totalPayment | currency : 'USD' : 'symbol' : '1.0-2' }}
          </p>
        </div>

        <!-- INLINE BREAKDOWN (BIGGER NUMBERS) -->
        <div class="flex items-center space-x-8">
          <div class="flex flex-col items-start">
            <span class="text-[0.65rem] text-slate-500">Base</span>
            <span class="text-base font-semibold text-slate-800">
              {{ patientSummary.payment.baseRate | currency : 'USD' : 'symbol' : '1.0-2' }}
            </span>
          </div>

          <div class="flex flex-col items-start">
            <span class="text-[0.65rem] text-slate-500">Comorb.</span>
            <span class="text-base font-semibold text-emerald-700">
              +{{
                patientSummary.payment.comorbidityAdjustment | currency : 'USD' : 'symbol' : '1.0-2'
              }}
            </span>
          </div>

          <div class="flex flex-col items-start">
            <span class="text-[0.65rem] text-slate-500">Functional</span>
            <span class="text-base font-semibold text-emerald-700">
              +{{
                patientSummary.payment.functionalLevelAdjustment
                  | currency : 'USD' : 'symbol' : '1.0-2'
              }}
            </span>
          </div>

          <div class="flex flex-col items-start">
            <span class="text-[0.65rem] text-slate-500">LUPA/LUTS</span>
            <span class="text-base font-semibold text-emerald-700">
              +{{ patientSummary.payment.lutsAdjustment | currency : 'USD' : 'symbol' : '1.0-2' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Page content -->
  <main class="flex-1 overflow-y-auto">
    <div class="max-w-8xl mx-auto px-8 py-6 space-y-6 text-sm">
      <!-- Top summary row -->
      <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="border border-slate-200 rounded-lg p-3 bg-white">
          <p class="text-xs text-slate-500">Patient</p>
          <p class="text-sm font-semibold text-slate-900">
            {{ patientSummary.demographics.name }}
          </p>
          <p class="text-[0.7rem] text-slate-500 mt-1">
            Age {{ patientSummary.demographics.age }} •
            {{ patientSummary.demographics.sex === 'F' ? 'Female' : 'Male' }}
          </p>
          <p class="text-[0.7rem] text-slate-500">DOB: {{ patientSummary.demographics.dob }}</p>
        </div>

        <div class="border border-slate-200 rounded-lg p-3 bg-white">
          <p class="text-xs text-slate-500">Care Team / Coverage</p>
          <p class="text-sm font-semibold text-slate-900">
            PCP: {{ patientSummary.demographics.pcp }}
          </p>
          <p class="text-[0.7rem] text-slate-500 mt-1">
            Insurance: {{ patientSummary.demographics.insurance }}
          </p>
          <p class="text-[0.7rem] text-slate-500">
            Member ID: {{ patientSummary.demographics.memberId }}
          </p>
        </div>

        <div class="border border-indigo-100 bg-indigo-50 rounded-lg p-3">
          <p class="text-xs text-slate-500 mb-1">HIPPS / Estimated Payment</p>
          <p class="text-sm font-semibold text-slate-900 tracking-wide">
            {{ patientSummary.payment.hippsCode }}
          </p>
          <p class="text-sm font-semibold text-emerald-700">
            {{ patientSummary.payment.totalPayment | currency : 'USD' : 'symbol' : '1.0-2' }}
          </p>
          <p class="text-[0.7rem] text-slate-500 mt-1">
            Includes comorbidity & functional level adjustments
          </p>
        </div>
      </section>

      <!-- Demographics -->
      <section class="border border-slate-200 rounded-lg p-4 space-y-3 bg-white">
        <header class="flex items-center justify-between mb-1">
          <h2 class="text-xs font-semibold tracking-wide text-slate-700 uppercase">Demographics</h2>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-xs text-slate-500">Address</p>
            <p class="font-medium text-slate-800">
              {{ patientSummary.demographics.address }}
            </p>
          </div>
          <div>
            <p class="text-xs text-slate-500">Phone</p>
            <p class="font-medium text-slate-800">
              {{ patientSummary.demographics.phone }}
            </p>
          </div>
          <div>
            <p class="text-xs text-slate-500">Agency</p>
            <p class="font-medium text-slate-800">
              {{ patientSummary.demographics.agencyName }}
            </p>
          </div>
          <div>
            <p class="text-xs text-slate-500">Insurance</p>
            <p class="font-medium text-slate-800">
              {{ patientSummary.demographics.insurance }}
            </p>
          </div>
          <div>
            <p class="text-xs text-slate-500">Member ID</p>
            <p class="font-medium text-slate-800">
              {{ patientSummary.demographics.memberId }}
            </p>
          </div>
        </div>
      </section>

      <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Episode History -->
        <div class="border border-slate-200 rounded-lg p-4 space-y-3 bg-white">
          <header class="flex items-center justify-between mb-1">
            <h2 class="text-xs font-semibold tracking-wide text-slate-700 uppercase">History</h2>
          </header>

          <div class="space-y-3">
            <div
              *ngFor="let ep of patientSummary.history"
              class="border border-slate-200 rounded-lg px-3 py-2.5 flex justify-between items-start"
            >
              <div>
                <p class="text-xs font-semibold text-slate-800">
                  {{ ep.type }}
                </p>

                <p class="text-[0.7rem] text-slate-500">
                  {{ ep.startDate }}
                  <ng-container *ngIf="ep.endDate"> &nbsp;–&nbsp;{{ ep.endDate }} </ng-container>
                </p>

                <p class="text-[0.7rem] text-slate-500 mt-1">
                  Clinician:
                  <span class="font-medium text-slate-700">
                    {{ ep.clinician }}
                  </span>
                </p>
              </div>

              <span
                class="px-2 py-0.5 text-[0.65rem] font-medium rounded-full"
                [ngClass]="
                  ep.status === 'Completed'
                    ? 'bg-emerald-100 text-emerald-700'
                    : 'bg-blue-100 text-blue-700'
                "
              >
                {{ ep.status }}
              </span>
            </div>
          </div>
        </div>

        <!-- Documents -->
        <div class="border border-slate-200 rounded-lg p-4 space-y-3 bg-white">
          <header class="flex items-center justify-between mb-1">
            <h2 class="text-xs font-semibold tracking-wide text-slate-700 uppercase">
              Documents (Medical Records)
            </h2>
          </header>

          <div class="space-y-2">
            <div
              *ngFor="let doc of patientSummary.docs"
              class="flex items-center justify-between border border-slate-100 rounded-md px-3 py-2"
            >
              <div>
                <p class="text-xs font-semibold text-slate-800">
                  {{ doc.displayLabel }}
                </p>

                <p class="text-[0.7rem] text-slate-500">Type: {{ doc.type }}</p>

                <p class="text-[0.7rem] text-slate-500 mt-0.5" *ngIf="doc.uploaded">
                  Uploaded: {{ doc.uploadedAt }} • {{ doc.fileName }}
                </p>

                <p class="text-[0.7rem] text-rose-600 mt-0.5" *ngIf="!doc.uploaded">
                  Missing:
                  <span class="italic">
                    {{ doc.missingReason || 'Not provided' }}
                  </span>
                </p>
              </div>

              <div class="flex items-center space-x-2">
                <span
                  *ngIf="doc.uploaded"
                  class="px-2 py-0.5 text-[0.65rem] font-medium rounded-full bg-emerald-100 text-emerald-700"
                >
                  Available
                </span>
                <span
                  *ngIf="!doc.uploaded"
                  class="px-2 py-0.5 text-[0.65rem] font-medium rounded-full bg-slate-100 text-slate-500"
                >
                  Missing
                </span>

                <button
                  *ngIf="doc.uploaded"
                  type="button"
                  (click)="onOpenDoc(doc)"
                  class="text-xs font-medium text-indigo-600 hover:text-indigo-800"
                >
                  Open →
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>
</div>
